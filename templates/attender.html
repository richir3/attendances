{% extends 'base.html' %}

{% block header %}
    Attender
{% endblock %}

{% block content %}
    <h2>Details</h2>
    <p>Name: {{ attender.name }}</p>
    <p>Surname: {{ attender.surname }}</p>
    <p>Email: {{ attender.email }}</p>
    <h2>Attendances</h2>
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Attendance</th>
            </tr>
        </thead>
        <tbody>
            {% for event in events %}
                <tr>
                    <td>{{ event.date }}</td>
                    {% if event in attendances %}
                        <td>Yes</td>
                    {% else %}
                        <td>No</td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Actions</h2>
    <button id="send-qr">Send QR code</button>
{% endblock %}

{% block scripts %}
    <script>
        document.getElementById('send-qr').addEventListener('click', function() {
            sendMail();
        });

        async function sendMail(){
            const csrfToken = getCookie("csrftoken");
            const response = await fetch('{% url "mail_code" attender.id %}', {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": csrfToken,
                },
            });

            const data = await response.json();
    
            if (response.ok) {
                alert(data.message);
            } else {
                alert(`Error: ${data.error || "Unknown error"}`);
            }
        };
    </script>
{% endblock %}
